<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pet Hope - Login</title>

    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <section class="signin-signout">
        <div>
            <!-- <img src="/img/PET-LOGIN.jpg" alt=""> -->
            <form id="formLogin" method="post" action="">
                <h1>Adote com PetHope!</h1>
                <p>Email</p>
                <input type="email" name="email" id="emailInput" placeholder="Email..">
                <p>Senha</p>
                <input type="password" name="password" id="passInput" placeholder="Senha..">
                <button type="submit">Entrar</button>
                <p class="cadastrar">Novo por aqui? <a href="cadastro.html">Crie uma conta</a></p>
            </form>
        </div>
        <p class="copyright">Â© 2023 PET HOPE</p>
    </section>

    <script>
        const formLogin = document.getElementById("formLogin");

        formLogin.addEventListener("submit", (event) => {
            event.preventDefault();

            let email = document.getElementById("emailInput").value;
            let senha = document.getElementById("passInput").value;

            fetch("http://localhost:3333/auth", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(
                    {
                        email: email,
                        password: senha
                    }
                )
            })
            .then(response => {
                if(!response.ok) {
                    throw new Error("Erro no login");
                }

                return response.json();
            })
            .then(data => {
                alert("Login bem-sucedido", data)
                //require parameter
                window.location.href = `doar.html?acessToken=${data.acessToken}`;
            })
            .catch(error => {
                alert("Erro no login", error)
            });
            
        });
    </script>
</body>
</html>