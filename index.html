<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pet Hope - Home</title>

    <link rel="stylesheet" href="/css/style.css">
    <script src="https://kit.fontawesome.com/88cbac72fc.js" crossorigin="anonymous" defer></script>
</head>
<body>
    <section class="home" id="home">
        <div class="navbar">
            <h1>PetHope</h1>
            <ul>
                <li><a href="#home">Home</a></li>
                <li><a href="#adotar">Adotar</a></li>
                <li><a id="admin" href="login.html">Administrar</a></li>
            </ul>
            <h1>Usu√°rio</h1>
        </div>
        <h1 class="titulo">Conhe√ßa o seu melhor amigo aqui</h1>
    </section>
    <section class="adotar" id="adotar">
        <h1>Veja os animais que temos em ado√ß√£o</h1>
        <div class="animais" id="animais">
            <div class="animal">
                <h2>Lebron</h2>
                <p>Ra√ßa: Labrador</p>
                <p>Idade: 1 ano</p>
                <img src="/img/PET-HOME-1.jpg" alt="">
                <a id="btnModal">Adotar</a>
            </div>
        </div>
        <dialog id="modal">
            <h2>Que not√≠cia boa!</h2>
            <p>Aperte em confirmar para adotar o seu animalzinho!</p>

            <button>Confirmar</button>
            <button id="btnCancelar">Cancelar</button>
        </dialog>
    </section>
    <section class="contato" id="contato">
        <div class="caixas">
            <ul>
                <li><a href="#home">Home</a></li>
                <li><a href="#adotar">Adotar</a></li>
                <li><a href="#contato">Contato</a></li>
                <li><a id="admin" href="login.html">Administrar</a></li>
            </ul>
        </div>
        <p>¬© 2023 PET HOPE</p>
    </section>

    <script>
        function criarDivAnimal(animal) {
            const divAnimal = document.createElement('div');
            divAnimal.classList.add('animal');
    
            const titulo = document.createElement('h2');
            titulo.textContent = animal.name;
            divAnimal.appendChild(titulo);
    
            const racaParagrafo = document.createElement('p');
            racaParagrafo.textContent = `Tipo: ${animal.type}`;
            divAnimal.appendChild(racaParagrafo);
    
            const idadeParagrafo = document.createElement('p');
            idadeParagrafo.textContent = `Idade: ${animal.age}`;
            divAnimal.appendChild(idadeParagrafo);

            const descricaoParagrafo = document.createElement('p');
            descricaoParagrafo.textContent = `Descri√ß√£o: ${animal.description}`;
            divAnimal.appendChild(descricaoParagrafo);

            const imagem = document.createElement('img');
            imagem.src = animal.imagemUrl;
            imagem.alt = '';
            divAnimal.appendChild(imagem);

            if(animal.imagemUrl == null)
            {
                const semFotoParagrafo = document.createElement('p');
                semFotoParagrafo.textContent = `(Animal sem fotinha ü•∫)`;
                divAnimal.appendChild(semFotoParagrafo);
            }
    
            const botaoAdotar = document.createElement('button');
            botaoAdotar.textContent = 'Adotar';
            botaoAdotar.id = 'btnModal';
            divAnimal.appendChild(botaoAdotar);
            console.log("primeiro")
    
            const divAnimaisExistente = document.getElementById('animais');
            divAnimaisExistente.appendChild(divAnimal);

            botaoAdotar.addEventListener('click', function() {
            excluirAnimal(animal.id);
    });
        }

        async function excluirAnimal(id) {
            try {
                const resposta = await fetch(`http://localhost:3333/pets/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                    if (resposta.ok) {
                        alert(`Bichinho adotado com sucesso! Trate-o com muito amor e carinho.`);

                    } else {
                        console.error(`Erro ao excluir o animal com ID ${id}.`);
                    }
                } catch (erro) {
                    console.error('Erro ao realizar a exclus√£o:', erro);
                }
            }
    
        async function buscarEExibirAnimais() {
            try {
                const resposta = await fetch('http://localhost:3333/pets');
                const dados = await resposta.json();
    
                dados.forEach(animal => criarDivAnimal(animal));
            } catch (erro) {
                console.error('Erro ao buscar dados da API:', erro);
            }
        }

        window.onload = function() {
            buscarEExibirAnimais();
        };
    </script>
</body>
</html>